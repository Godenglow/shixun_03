# 心理测试小程序 - 云数据库初始化步骤

## 1. 创建数据库集合

在微信开发者工具中打开云开发控制台，按以下步骤操作：

### 1.1 创建用户集合 (users)
- 集合名称: `users`
- 权限: **自定义安全规则**（推荐）

### 1.2 创建测试集合 (tests)
- 集合名称: `tests`
- 权限: **所有用户可读**

### 1.3 创建题目集合 (questions)
- 集合名称: `questions`
- 权限: **所有用户可读**

### 1.4 创建测试记录集合 (records)
- 集合名称: `records`
- 权限: **创建者可见**

## 2. 添加测试数据

### 2.1 在 tests 集合中添加数据
复制以下JSON数据到 `tests` 集合中：

```json
{
  "_id": "test_personality_001",
  "title": "性格类型测试",
  "description": "通过一系列问题了解你的性格类型，帮助你更好地认识自己",
  "type": "personality",
  "typeName": "性格测试",
  "coverImage": "",
  "questionCount": 10,
  "maxScore": 100,
  "createTime": new Date(),
  "status": "active"
}
```

```json
{
  "_id": "test_anxiety_001", 
  "title": "焦虑水平测试",
  "description": "评估你当前的焦虑水平，了解自己的情绪状态",
  "type": "anxiety",
  "typeName": "焦虑测试",
  "coverImage": "",
  "questionCount": 8,
  "maxScore": 80,
  "createTime": new Date(),
  "status": "active"
}
```

### 2.2 在 questions 集合中添加题目数据

#### 性格测试题目：

```json
{
  "_id": "question_personality_001",
  "testId": "test_personality_001",
  "order": 1,
  "question": "在社交场合中，你通常：",
  "options": [
    { "id": "A", "text": "主动与他人交谈，享受社交", "score": 10 },
    { "id": "B", "text": "等待他人来找你聊天", "score": 6 },
    { "id": "C", "text": "选择安静的角落观察他人", "score": 3 },
    { "id": "D", "text": "尽量避免社交场合", "score": 1 }
  ],
  "createTime": new Date()
}
```

```json
{
  "_id": "question_personality_002",
  "testId": "test_personality_001",
  "order": 2,
  "question": "面对新的挑战时，你通常：",
  "options": [
    { "id": "A", "text": "感到兴奋，迫不及待想尝试", "score": 10 },
    { "id": "B", "text": "仔细考虑后再决定", "score": 7 },
    { "id": "C", "text": "需要一些时间适应", "score": 4 },
    { "id": "D", "text": "感到担忧，尽量避免", "score": 1 }
  ],
  "createTime": new Date()
}
```

#### 焦虑测试题目：

```json
{
  "_id": "question_anxiety_001",
  "testId": "test_anxiety_001",
  "order": 1,
  "question": "最近一周，你感到紧张或焦虑的频率是：",
  "options": [
    { "id": "A", "text": "几乎每天都有", "score": 10 },
    { "id": "B", "text": "经常（每周3-4次）", "score": 7 },
    { "id": "C", "text": "偶尔（每周1-2次）", "score": 4 },
    { "id": "D", "text": "很少或没有", "score": 1 }
  ],
  "createTime": new Date()
}
```

```json
{
  "_id": "question_anxiety_002",
  "testId": "test_anxiety_001",
  "order": 2,
  "question": "你的睡眠质量如何？",
  "options": [
    { "id": "A", "text": "经常失眠或睡眠质量差", "score": 10 },
    { "id": "B", "text": "偶尔失眠", "score": 6 },
    { "id": "C", "text": "基本正常", "score": 3 },
    { "id": "D", "text": "睡眠质量很好", "score": 1 }
  ],
  "createTime": new Date()
}
```

## 3. 设置数据库权限

### 3.1 users 集合权限设置
```javascript
{
  "read": "auth != null",
  "write": "doc._openid == auth.openid"
}
```

### 3.2 tests 集合权限设置
```javascript
{
  "read": true,
  "write": false
}
```

### 3.3 questions 集合权限设置
```javascript
{
  "read": true,
  "write": false
}
```

### 3.4 records 集合权限设置
```javascript
{
  "read": "doc._openid == auth.openid",
  "write": "doc._openid == auth.openid"
}
```

## 4. 验证初始化

完成以上步骤后，回到小程序，点击首页的测试项目，如果能正常显示测试列表，说明数据库初始化成功。

## 5. 下一步操作

1. 部署云函数（在云开发控制台中部署 login、generateReport、uploadImage 函数）
2. 在小程序代码中设置正确的云环境ID
3. 测试各个功能模块