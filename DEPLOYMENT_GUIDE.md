# 心理测试小程序部署指南

## 🚀 快速开始

### 1. 准备工作

#### 必需条件
- 微信小程序账号
- 微信开发者工具
- 基础的前端开发知识

#### 开通服务
1. 登录[微信公众平台](https://mp.weixin.qq.com/)
2. 注册小程序账号
3. 开通微信云开发服务

### 2. 项目配置

#### 修改配置文件
1. 打开 `project.config.json`
2. 将 `appid` 替换为你的小程序AppID
3. 保存文件

#### 配置云环境
1. 打开 `app.js`
2. 找到 `env: 'test-1'` 这行代码
3. 将 `'test-1'` 替换为你的云环境ID
4. 保存文件

### 3. 云开发配置

#### 创建云环境
1. 打开微信开发者工具
2. 点击顶部菜单的"云开发"
3. 点击"开通云开发"
4. 选择环境名称（记住这个名称，用于配置）

#### 部署云函数
1. 在项目根目录右键点击 `cloudfunctions` 文件夹
2. 选择"上传并部署：云端安装依赖"
3. 等待部署完成

#### 初始化数据库
1. 在开发者工具中点击"云开发" → "数据库"
2. 创建以下集合：
   - `users` - 用户集合
   - `tests` - 测试集合
   - `questions` - 题目集合
   - `records` - 记录集合

3. 设置数据库权限：
   - 用户集合：仅创建者可读写
   - 测试集合：所有用户可读，仅管理员可写
   - 题目集合：所有用户可读，仅管理员可写
   - 记录集合：仅创建者可读写

### 4. 添加测试数据

#### 手动添加测试
在数据库控制台执行以下操作：

**添加测试信息**（tests集合）：
```json
{
  "_id": "test_personality_001",
  "title": "性格类型测试",
  "description": "通过一系列问题了解你的性格类型",
  "type": "personality",
  "typeName": "性格测试",
  "coverImage": "cloud://your-env-id/personality-test.jpg",
  "questionCount": 10,
  "maxScore": 100,
  "createTime": new Date(),
  "status": "active"
}
```

**添加题目**（questions集合）：
```json
{
  "testId": "test_personality_001",
  "order": 1,
  "question": "在社交场合中，你通常：",
  "options": [
    { "id": "A", "text": "主动与他人交谈，享受社交", "score": 10 },
    { "id": "B", "text": "等待他人来找你聊天", "score": 6 },
    { "id": "C", "text": "选择安静的角落观察他人", "score": 3 },
    { "id": "D", "text": "尽量避免社交场合", "score": 1 }
  ],
  "createTime": new Date()
}
```

### 5. 云存储配置

#### 上传图片
1. 点击"云开发" → "存储"
2. 创建文件夹 `psychology-test`
3. 上传测试封面图片
4. 复制图片的 `cloud://` 路径

#### 默认图片
上传以下默认图片到云存储：
- `default-avatar.png` - 默认头像
- `default-test.png` - 默认测试封面
- `personality-test.jpg` - 性格测试封面
- `anxiety-test.jpg` - 焦虑测试封面

### 6. 测试运行

#### 本地测试
1. 点击"编译"按钮
2. 在模拟器中测试各项功能
3. 检查控制台是否有错误信息

#### 真机测试
1. 点击"预览"按钮
2. 用微信扫描二维码
3. 在手机上测试完整功能

### 7. 发布上线

#### 提交审核
1. 点击"上传"按钮
2. 填写版本号和描述
3. 上传代码到微信后台
4. 在微信公众平台提交审核

#### 发布版本
审核通过后，在微信公众平台发布版本。

## 🔧 常见问题解决

### 云函数部署失败
- 检查网络连接
- 确认云环境ID正确
- 查看云开发控制台日志

### 数据库权限问题
- 检查集合权限设置
- 确认用户身份验证
- 查看数据库操作日志

### 图片加载失败
- 检查云存储路径
- 确认图片文件存在
- 检查图片访问权限

### 登录失败
- 检查用户授权设置
- 确认云函数正常运行
- 查看登录云函数日志

## 📞 技术支持

如遇到技术问题，请：
1. 查看微信开发者工具控制台日志
2. 检查云开发控制台错误信息
3. 参考微信小程序官方文档
4. 在相关技术社区寻求帮助

## ⚠️ 重要提醒

1. **隐私保护**：确保用户数据安全，遵守相关法律法规
2. **免责声明**：测试结果仅供参考，不能替代专业心理咨询
3. **数据备份**：定期备份重要数据
4. **性能监控**：关注小程序运行性能

---

部署完成后，你的心理测试小程序就可以正常运行了！祝开发顺利！ 🎉