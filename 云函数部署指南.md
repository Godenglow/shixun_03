# 云函数部署完整指南

## 🎯 当前状态
- ✅ 云环境已配置：`cloud1-3g1l2z3l3e2d47b6`
- ✅ 小程序已启动，开始初始化数据库
- ⚠️ 需要部署云函数

## 📦 需要部署的云函数

### 1. login 云函数
**作用**：用户登录，获取用户 openid

### 2. generateReport 云函数  
**作用**：生成心理测试报告

### 3. uploadImage 云函数
**作用**：处理图片上传到云存储

### 4. initDatabase 云函数
**作用**：初始化数据库集合和示例数据

## 🚀 部署步骤

### 方法1：单个部署（推荐新手）
1. 在微信开发者工具中，右键点击 `cloudfunctions/login` 文件夹
2. 选择 **"上传并部署"**
3. 等待部署完成
4. 重复步骤1-3，部署其他3个云函数

### 方法2：批量部署（高级用户）
1. 在 `cloudfunctions` 根目录下创建一个 `package.json`：
```json
{
  "name": "psychology-test-cloudfunctions",
  "version": "1.0.0",
  "description": "心理测试小程序云函数集合",
  "dependencies": {
    "wx-server-sdk": "~2.6.3"
  }
}
```
2. 选中所有云函数文件夹
3. 右键选择 **"上传并部署"**

## ⚡ 快速验证部署

部署完成后，在微信开发者工具控制台运行：

```javascript
// 检查登录函数
wx.cloud.callFunction({
  name: 'login'
}).then(res => {
  console.log('✅ login 函数正常', res.result)
}).catch(err => {
  console.error('❌ login 函数异常', err)
})
```

## 🔧 常见问题解决

### Q1: 云函数部署失败
**解决方案**：
1. 检查网络连接
2. 确保微信开发者工具版本最新
3. 重启开发者工具后重试

### Q2: 提示"函数不存在"
**解决方案**：
1. 确认云函数名称正确
2. 检查是否在正确的云环境中
3. 重新部署该云函数

### Q3: 数据库初始化失败
**解决方案**：
1. 确认 `initDatabase` 云函数已部署
2. 检查云函数执行日志
3. 在云开发控制台中手动创建集合

## 📋 部署检查清单

- [ ] login 云函数已部署
- [ ] generateReport 云函数已部署  
- [ ] uploadImage 云函数已部署
- [ ] initDatabase 云函数已部署
- [ ] 控制台无云函数调用错误
- [ ] 数据库初始化成功

## 🎉 部署成功的标志

当所有云函数部署成功后，您应该看到：
1. 控制台显示 `✅ 数据库初始化成功`
2. 小程序首页可以正常显示
3. 可以进行登录测试
4. 可以查看测试列表